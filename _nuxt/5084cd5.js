(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{368:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return l}));var r=n(8),c=(n(51),n(13),n(17),n(63),n(3)),o=function(){function e(e,t){switch(e){case"public":this.access="public";break;case"friend":this.access="friend";break;default:this.access="private"}this.id=t.uid,this.name=t.displayName,this.email=t.email}e.init=function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(n){var r,data;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(e,t){c.a.onAuthStateChanged((function(n){n?e(n):t("Not Login")}))}));case 2:return r=t.sent,data=new e(n,r),t.abrupt("return",data);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();var t=e.prototype;return t.set=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.b.collection(this.access).doc(this.id).update(((r={})[t]=n,r));case 3:e.next=11;break;case 5:return e.prev=5,e.t0=e.catch(0),e.next=9,c.b.collection(this.access).doc(this.id).set({id:this.id});case 9:return e.next=11,c.b.collection(this.access).doc(this.id).update(((o={})[t]=n,o));case 11:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t,n){return e.apply(this,arguments)}}(),t.get=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t){var data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.b.collection(this.access).doc(this.id).get();case 2:if(data=e.sent.data(),null!=t){e.next=7;break}return e.abrupt("return",data);case 7:return e.abrupt("return",data[t]);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.getPoint=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(){var data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.b.collection("public").doc(this.id).get();case 2:return data=e.sent.data().point,e.abrupt("return",data);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.setPoint=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(p){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.b.collection("public").doc(this.id).update({point:p});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.setZukan=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(p){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get("zukanID");case 2:if(e.t0=t=e.sent,null==e.t0){e.next=7;break}e.t1=t,e.next=8;break;case 7:e.t1=[];case 8:return n=e.t1,console.log(n),console.log(p),n.push(p),e.next=14,c.b.collection("public").doc(this.id).update({zukanID:n});case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.getAll=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t){var data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("public"!=this.access&&"friend"!=this.access){e.next=9;break}return data=[],e.next=4,c.b.collection(this.access).limit(20).orderBy("point","desc").get();case 4:return e.next=6,e.sent.forEach((function(e){null==t?data.push({id:e.id,value:e.data()}):data.push({id:e.id,value:e.data()[t]})}));case 6:return e.abrupt("return",data);case 9:return e.abrupt("return");case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.setFile=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.d.ref().child(this.id+"/"+t).put(n);case 2:return r=e.sent,e.abrupt("return",r.ref.getDownloadURL());case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),t.getFile=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.d.ref().child(this.id+"/"+t).getDownloadURL();case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.deleteFile=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.d.ref().child(this.id+"/"+t).delete();case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),e}();function l(e){return d.apply(this,arguments)}function d(){return(d=Object(r.a)(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.d.ref().child(t+"/userPhoto").getDownloadURL();case 3:return a=e.sent,e.abrupt("return",a);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return","default");case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}},565:function(e,t,n){"use strict";n.r(t);var r=n(8),c=(n(22),n(55),n(13),n(48),n(40),n(52),n(113),n(17),n(72),n(51),n(524)),o=n.n(c),data=(n(526),n(368)),l={components:{VueCropper:o.a},data:function(){return{step:1,imgSrc:"",visionResult:void 0,includeList:[],AllerPatterns:[{name:"卵",patterns:["卵","たまご","タマゴ"]},{name:"乳",patterns:["牛乳","脱脂粉乳","練乳","はっ酵乳","全粉乳"]},{name:"小麦",patterns:["小麦"]},{name:"そば",patterns:["そば","蕎麦"]},{name:"落花生（ピーナッツ）",patterns:["ピーナッツ","落花生"]},{name:"えび",patterns:["えび","エビ","海老"]},{name:"かに",patterns:["かに","カニ","蟹"]}]}},methods:{addDropFile:function(e){this.setImage(e.dataTransfer.files[0])},setImage:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:(r=new FileReader).onload=function(e){t.imgSrc=e.target.result,t.step=2},r.readAsDataURL(e);case 3:case"end":return n.stop()}}),n)})))()},cropImage:function(){this.imgSrc=this.$refs.cropper.getCroppedCanvas().toDataURL(),this.step=3,this.sendVisionAPI()},sendVisionAPI:function(){var e=this,data={requests:[{image:{content:this.imgSrc.split("base64,")[1]},features:[{maxResults:50,type:"DOCUMENT_TEXT_DETECTION"},{maxResults:50,type:"CROP_HINTS"},{maxResults:50,type:"LABEL_DETECTION"}]}]};fetch("https://vision.googleapis.com/v1/images:annotate?key=AIzaSyB8-ldByAwinojKoMBHNkvO-0ciC_ZrvXo",{method:"POST",headers:{"Content-Type":"application/json"},redirect:"follow",body:JSON.stringify(data),cache:"no-cache",mode:"cors"}).then((function(body){return body.json()})).then((function(t){e.visionResult=t.responses[0].fullTextAnnotation.text,e.matchPattern()}))},matchPattern:function(){var e=this;this.AllerPatterns.map((function(t){t.patterns.map((function(a){return!!e.visionResult.match(a)})).includes(!0)&&e.includeList.push(t.name)})),console.log("this includes "+this.includeList)},selectElement:function(e){var t=this,n=function(t){var data=[{name:"卵",id:"egg"},{name:"えび",id:"shrimp"},{name:"かに",id:"crab"},{name:"そば",id:"soba"},{name:"小麦",id:"wheat"},{name:"乳",id:"milk"},{name:"落花生（ピーナッツ）",id:"peanut"}],i=data.map((function(t){return e===t.name})).indexOf(!0);return data[i].id}();console.log(n);var r=[{name:"卵",id:"egg"},{name:"乳",id:"milk"},{name:"小麦",id:"wheat"},{name:"そば",id:"soba"},{name:"落花生（ピーナッツ）",id:"peanut"},{name:"えび",id:"shrimp"},{name:"かに",id:"crab"}].map((function(e,t){return Object.assign({},e,{index:t})})).filter((function(e,t){return e.id==n}));console.log(r[0].index),console.log("id : ",n),console.log("uploading ... "),data.a.init("public").then((function(e){e.setZukan(r[0].index)})),data.a.init("private").then((function(data){return data.setFile(n,t.file)})).then((function(){console.log("Uploaded.")})),this.$router.push({path:"battle",query:{id:n}})}}},d=n(39),f=n(62),m=n.n(f),h=n(358),v=n(183),x=n(392),w=n(364),R=n(408),k=n(428),y=n(571),_=n(456),O=n(457),j=n(416),C=n(458),component=Object(d.a)(l,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",[n("v-stepper",{attrs:{"alt-labels":""},model:{value:e.step,callback:function(t){e.step=t},expression:"step"}},[n("v-stepper-header",[n("v-stepper-step",{attrs:{step:"1",complete:e.step>1}},[e._v("\n        スキャン画像のアップロード\n      ")]),e._v(" "),n("v-divider"),e._v(" "),n("v-stepper-step",{attrs:{step:"2"}},[e._v("\n        画像の調整\n      ")]),e._v(" "),n("v-divider"),e._v(" "),n("v-stepper-step",{attrs:{step:"3"}},[e._v("\n        スキャン結果の選択\n      ")])],1),e._v(" "),n("v-stepper-items",[n("v-stepper-content",{attrs:{step:"1"}},[n("v-container",{on:{drop:function(t){return t.preventDefault(),e.addDropFile.apply(null,arguments)},dragover:function(e){e.preventDefault()}}},[n("v-file-input",{attrs:{accept:"image/png, image/jpeg, image/bmp","prepend-icon":"mdi-camera",placeholder:"画像をここにドロップするか、選択してください。",capture:"environment"},on:{change:e.setImage}})],1)],1),e._v(" "),n("v-stepper-content",{attrs:{step:"2"}},[""!=e.imgSrc?n("vue-cropper",{ref:"cropper",staticClass:"cropper",attrs:{src:e.imgSrc,guides:!0,"view-mode":2,"auto-crop-area":1,background:!0,"drag-mode":"crop"}}):e._e(),n("br"),e._v(" "),n("v-btn",{attrs:{elevation:"2",block:"",color:"primary"},on:{click:e.cropImage}},[e._v("次へ")])],1),e._v(" "),n("v-stepper-content",{attrs:{step:"3"}},[""!==e.visionResult?n("v-container",e._l(e.includeList,(function(t){return n("v-container",{key:t},[n("v-card",{attrs:{elevation:"2"}},[n("v-card-title",{domProps:{textContent:e._s(t)}}),e._v(" "),n("v-card-actions",[n("v-btn",{attrs:{text:""},on:{click:function(n){return e.selectElement(t)}}},[e._v(" この品目で進む ")])],1)],1)],1)})),1):e._e()],1)],1)],1)],1)}),[],!1,null,null,null);t.default=component.exports;m()(component,{VApp:h.a,VBtn:v.a,VCard:x.a,VCardActions:w.a,VCardTitle:w.d,VContainer:R.a,VDivider:k.a,VFileInput:y.a,VStepper:_.a,VStepperContent:O.a,VStepperHeader:j.a,VStepperItems:j.b,VStepperStep:C.a})}}]);